var app = angular.module("youdrawit", [function() {
	
	var drawing = false;
	var lastX;
	var lastY;
	var svgElement = angular.element(document.getElementById('svg'));
	var svg = d3.select(document.getElementById('svg'));
	var socket = io();
	socket.on('data', function(data) {
		console.log(data);
		// switch(data.type){
		// case 'startLine':
		// startLine(data.x, data.y);
		// break;
		// case 'endLine':
		// endLine(data.x, data.y);
		// break;
		// case 'moveTo':
		// endLine(data.x, data.y);
		// break;
		// }
	});
	
	svgElement.on('mouseleave', function(event) {
		drawing = false;
	});

	svgElement.on('mousedown', function(event) {
		
		console.log("mousedown.event.currentTarget.offsetLeft: " + event.currentTarget.offsetLeft);
		console.log("mousedown.event.layerX: " + event.layerX);
		
		lastX = event.layerX;
		lastY = event.layerY;				
		drawing = true;
	});

	svgElement.on('mousemove', function(event) {
		
		if (drawing) {
			
			var currentX = event.layerX;
			var currentY = event.layerY;

			draw(lastX, lastY, currentX, currentY);
			send(lastX, lastY, currentX, currentY);

			// set current coordinates to last one
			lastX = currentX;
			lastY = currentY;
		}

	});
	svgElement.on('mouseup', function(event) {
		// stop drawing
		drawing = false;
	});
	

	// canvas reset
	function reset() {
		
	}

	function send(x1, y1, x2, y2) {
		
	}

	function draw(x1, y1, x2, y2) {		
		svg.append('line')
			.attr("data-id", 8)
			.attr("x1", x1)
			.attr("y1", y1)
			.attr("x2", x2)
			.attr("y2", y2)
			.attr("stroke-linecap", "round")
			.attr("stroke-width", 33)
			.attr("stroke", "#4bf");
	}

}]);

// app.factory('socketService', function() {
  // var socketService;
  // // factory function body that constructs shinyNewServiceInstance
  // return socketService;
// });
// 
// app.directive("drawing", function() {
	// return {
		// restrict : "A",
		// link : function(scope, element) {
// 
			// var svg = d3.select(element[0]);
			// var drawing = false;
			// var lastX;
			// var lastY;
// 
			// element.bind('mouseleave', function(event) {
				// drawing = false;
			// });
// 
			// element.bind('mousedown', function(event) {
// 				
				// console.log("mousedown.event.currentTarget.offsetLeft: " + event.currentTarget.offsetLeft);
				// console.log("mousedown.event.layerX: " + event.layerX);
// 				
				// lastX = event.layerX;
				// lastY = event.layerY;				
				// drawing = true;
			// });
// 
			// element.bind('mousemove', function(event) {
// 				
				// if (drawing) {
// 					
					// var currentX = event.layerX;
					// var currentY = event.layerY;
// 
					// draw(lastX, lastY, currentX, currentY);
					// send(lastX, lastY, currentX, currentY);
// 
					// // set current coordinates to last one
					// lastX = currentX;
					// lastY = currentY;
				// }
// 
			// });
			// element.bind('mouseup', function(event) {
				// // stop drawing
				// drawing = false;
			// });
// 			
// 
			// // canvas reset
			// function reset() {
// 				
			// }
// 
			// function send(x1, y1, x2, y2) {
// 				
			// }
// 
			// function draw(x1, y1, x2, y2) {
				// svg.append('line')
					// .attr("data-id", 8)
					// .attr("x1", x1)
					// .attr("y1", y1)
					// .attr("x2", x2)
					// .attr("y2", y2)
					// .attr("stroke-linecap", "round")
					// .attr("stroke-width", 33)
					// .attr("stroke", "#4bf");
			// }
		// }
	// };
// });

